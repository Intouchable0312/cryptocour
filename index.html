<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prix des Cryptomonnaies en Temps Réel</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Section gauche : liste des cryptos -->
        <div class="crypto-list">
            <h1>Cryptomonnaies</h1>
            <div class="crypto-grid" id="crypto-prices"></div>
        </div>

        <!-- Section droite : graphique TradingView -->
        <div class="tradingview-container">
            <div class="tradingview-widget-container__widget" id="tradingview-widget"></div>
        </div>
    </div>

    <script defer>
        const cryptoSymbols = {
            'bitcoin': 'COINBASE:BTCEUR',
            'ethereum': 'COINBASE:ETHEUR',
            'litecoin': 'COINBASE:LTCEUR',
            'ripple': 'COINBASE:XRPEUR',
            'cardano': 'BINANCE:ADAEUR',
            'polkadot': 'BINANCE:DOTEUR',
            'solana': 'BINANCE:SOLEUR',
            'bitcoin-cash': 'COINBASE:BCHUSD',
            'stellar': 'BINANCE:XLMEUR',
            'chainlink': 'BINANCE:LINKEUR',
            'uniswap': 'BINANCE:UNIEUR',
            'binancecoin': 'BINANCE:BNBEUR',
            'monero': 'BINANCE:XMREUR',
            'dogecoin': 'BINANCE:DOGEEUR',
            'vechain': 'BINANCE:VETEUR',
            'cosmos': 'BINANCE:ATOMEUR',
            'avax': 'BINANCE:AVAXEUR',
            'dai': 'BINANCE:DAIEUR',
            'shiba-inu': 'BINANCE:SHIBEUR'
        };

        async function obtenirPrixCrypto() {
            const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=eur&ids=bitcoin,ethereum,litecoin,ripple,cardano,polkadot,solana,bitcoin-cash,stellar,chainlink,uniswap,binancecoin,monero,dogecoin,tezos,vechain,cosmos,algorand,avax,dai,shiba-inu';

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Erreur: ${response.status}`);
                }

                const data = await response.json();
                const cryptoPricesDiv = document.getElementById('crypto-prices');

                cryptoPricesDiv.innerHTML = data.map(crypto => {
                    const symbol = cryptoSymbols[crypto.id];
                    if (symbol) {
                        return `
                            <div class="crypto-item" onclick="changerGraphique('${symbol}')">
                                <img src="${crypto.image}" alt="${crypto.name} Logo" class="crypto-logo">
                                <h2>${crypto.name}</h2>
                                <p>${crypto.current_price.toFixed(2)} EUR</p>
                            </div>
                        `;
                    } else {
                        return ''; // Sauter les cryptos non trouvées dans cryptoSymbols
                    }
                }).join('');
            } catch (error) {
                console.error("Erreur lors de la récupération des données:", error);
            }
        }

        function changerGraphique(symbol) {
            const widgetDiv = document.getElementById('tradingview-widget');
            widgetDiv.innerHTML = ''; // Supprime le contenu précédent pour recréer le widget

            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
            script.async = true;
            script.innerHTML = JSON.stringify({
                "autosize": true,
                "symbol": symbol,
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "dark",
                "style": "3",
                "locale": "fr",
                "hide_legend": true,
                "allow_symbol_change": true,
                "save_image": false,
                "calendar": false,
                "hide_volume": true,
                "support_host": "https://www.tradingview.com"
            });

            widgetDiv.appendChild(script); // Insère le nouveau widget
        }

        // Charge les prix et initialise le graphique
        obtenirPrixCrypto();
        changerGraphique('COINBASE:BTCEUR'); // Affiche Bitcoin par défaut au chargement
    </script>
</body>

</html>
